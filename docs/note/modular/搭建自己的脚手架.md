# æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶

## æ­å»ºcli

åˆ›å»ºä¸€ä¸ªRoy-cliæ–‡ä»¶å¤¹,cdåˆ°åœ¨è¯¥æ–‡ä»¶å¤¹å†…åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®
```js
npm init -y
```

ç„¶ååˆ›å»ºä¸€ä¸ªbinæ–‡ä»¶å¤¹,åœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªroycliç„¶åé€‰æ‹©JavaScriptç¼–å†™æ–¹å¼ï¼Œé‡Œé¢è¾“å…¥:
```js
#!/usr/bin/env node 

console.log('roy-cli')
```
å€¼å¾—æ³¨æ„çš„æ˜¯`#!/usr/bin/env node`å¿…é¡»æ”¾åœ¨æ–‡ä»¶å¼€å¤´ç¬¬ä¸€è¡Œï¼Œè¡¨ç¤ºæˆ‘è¦ç”¨ç³»ç»Ÿä¸­çš„è¿™ä¸ªç›®å½•`/user/bin/env`çš„nodeç¯å¢ƒæ¥æ‰§è¡Œæ­¤æ–‡ä»¶ã€‚

åœ¨ **package.json** ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®:
```js
"bin": {
    "roycli": "bin/roycli"
}
```

æ‰§è¡Œ`npm link`ï¼Œå¦‚æœæŠ¥é”™è¯·ç”¨`sudo npm link`
```js
npm notice created a lockfile as package-lock.json. You should commit this file.
npm WARN roy-cli@1.0.0 No description
npm WARN roy-cli@1.0.0 No repository field.

up to date in 10.102s
/usr/local/bin/roycli -> /usr/local/lib/node_modules/roy-cli/bin/roycli
/usr/local/lib/node_modules/roy-cli -> /Users/xucong/Desktop/åŸºç¡€çŸ¥è¯†/Roy-cli
```
å®‰è£…æˆåŠŸï¼Œå¯ä»¥é€šè¿‡`which roycli`å‘½ä»¤æ¥çœ‹ç»“æœï¼Œè¾“å‡º`/usr/local/bin/roycli`ã€‚

linkå°†ä¸€ä¸ªä»»æ„ä½ç½®çš„npmåŒ…é“¾æ¥åˆ°å…¨å±€æ‰§è¡Œç¯å¢ƒï¼Œä»è€Œåœ¨ä»»æ„ä½ç½®ä½¿ç”¨å‘½ä»¤è¡Œéƒ½å¯ä»¥æ‰§è¡Œè¿è¡Œè¯¥npmåŒ…ã€‚npm linkå‘½ä»¤é€šè¿‡é“¾æ¥ç›®å½•å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ç°npmåŒ…å‘½ä»¤çš„å…¨å±€å¯æ‰§è¡Œã€‚

åœ¨ç»ˆç«¯æ‰§è¡Œ **roycli**

è¾“å‡ºäº†roy-cliã€‚

## ç¼–å†™cli

å®‰è£…figletç”Ÿæˆä¸€äº›ç‰¹æ®Šçš„æ–‡å­—
```js
npm install figlet -S
```
å®‰è£… @darkobits/lolcatjs ç”Ÿæˆé¢œè‰²
```js
npm install @darkobits/lolcatjs -S
```

åœ¨royclié‡Œé¢ç¼–å†™å¦‚ä¸‹ä»£ç :
```js
#!/usr/bin/env node 

const figlet = require('figlet');
const versionSt = figlet.textSync("RoyCli");
const Printer = require('@darkobits/lolcatjs');
const transformed = Printer.default.fromString(versionSt);

console.log(transformed)
```
åœ¨ç»ˆç«¯è¿è¡Œroycliåå‡ºç°äº†ä¸‹å›¾è¿™ä¸ªç‚«å½©çš„æ•ˆæœ

![](/modular/1609686191658.jpg)

æˆ‘ä»¬ç»§ç»­ä¿®æ”¹æˆ‘ä»¬çš„cliï¼Œä½¿ç”¨commanderæ’ä»¶ï¼Œå®ƒæ˜¯npmä¾èµ–æ’è¡Œå‰åä¹‹ä¸€çš„æ¨¡å—ï¼Œä¸»è¦ä½œç”¨ä¸ºå‘½ä»¤è¾…åŠ©

å®‰è£…æ¨¡å—
```js
npm install shelljs commander -S
```

æˆ‘ä»¬å¼•å…¥commander,ä»£ç å¦‚ä¸‹:
```js
const { program } = require('commander');

program
 .option('-c, create', 'åˆ›å»ºä¸€ä¸ªç»„ä»¶')
 .option('-j, json2ts', 'ç”ŸæˆTypeScript');

program.parse(process.argv);
```
åœ¨ç»ˆç«¯æ‰§è¡Œroycli --helpå‘ç°æˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªå‘½ä»¤åœ¨helpé‡Œé¢äº†:

![](/modular/1609686814031.jpg)


æ¥ä¸‹æ¥æˆ‘ä»¬ç©ä¸€ä¸ªèŠ±çš„ï¼Œåœ¨royclié‡Œé¢åŠ å…¥
```js
const version = require('../package.json').version;
const transformed = Printer.default.fromString(
    ` \n Royçš„è„šæ‰‹æ¶${version} \n æŠ€æœ¯åšå®¢åœ°å€:http://115.28.139.70:8081/ \n ${versionSt}`
);
program.version(transformed);
```

æ€»ä½“ä»£ç å¦‚ä¸‹
```js
#!/usr/bin/env node 

const figlet = require('figlet');
const versionSt = figlet.textSync("RoyCli");
const Printer = require('@darkobits/lolcatjs');
const version = require('../package.json').version;
const transformed = Printer.default.fromString(
    ` \n Royçš„è„šæ‰‹æ¶${version} \n æŠ€æœ¯åšå®¢åœ°å€:http://115.28.139.70:8081/ \n ${versionSt}`
);
const { program } = require('commander');


program.version(transformed);
program
 .option('-c, create', 'åˆ›å»ºä¸€ä¸ªç»„ä»¶')
 .option('-j, json2ts', 'ç”ŸæˆTypeScript');

program.parse(process.argv);
```

ç»ˆç«¯æ‰§è¡Œroycli -Væˆ–è€…roycli --version æœ€åè¾“å‡ºå¦‚ä¸‹:

![](/modular/1609687262344.jpg)


### ä»£ç ç”Ÿæˆ 

å®‰è£…æ’ä»¶
```js
npm install chalk quicktype -S
```
chalkæ˜¯nodeç»ˆç«¯æ ·å¼åº“

quicktypeæ˜¯å¿«é€Ÿç”Ÿæˆ


å¼•å…¥`const chalk = require('chalk');`ï¼ŒåŠ å…¥ä»£ç :
```js
const handlers = {
    json2ts(dataURL){
        console.log('è¿›å…¥å‡½æ•°');
    }
};

program
    .usage('[cmd] <options>')
    .arguments('<cmd> [env]')
    .action((cmd,otherParams) =>{
        const handler = handlers[cmd];
        if(typeof handler == 'undefine'){

            console.log(chalk.blue(`${cmd}`)+chalk.red('æš‚ä¸æ”¯æŒ'));
        }else{
            handler(otherParams);
        }
    })
```
ç»ˆç«¯è¾“å…¥roycli xxx æç¤ºxxxæš‚ä¸æ”¯æŒï¼Œè¾“å…¥`roycli json2ts https://goo.gl/Dq2yKd`æ˜¾ç¤ºè¿›å…¥å‡½æ•°

ç„¶åæˆ‘ä»¬åœ¨package.json é…ç½®å¦‚ä¸‹ä»£ç :
```js
"scripts": {
    "test": "quicktype https://api.github.com/ -o Weather.ts --runtime-typecheck"
  },
```
ç„¶åè¿è¡Œnpm test ç„¶åç”Ÿæˆäº†Weather.tsæ–‡ä»¶ã€‚

## å®ç°å’Œvue-cliç±»ä¼¼çš„ä¸ç”¨æˆ·äº¤äº’

å®‰è£…åŒ…:
```js
npm install inquirer ora  download-git-repo
```

- inquirer:äº¤äº’å¼å‘½ä»¤è¡Œï¼Œå¯ä»¥å’Œç”¨æˆ·è¿›è¡Œäº¤äº’
- ora:Node.jsç»ˆç«¯åŠ è½½åŠ¨ç”»æ•ˆæœ
- download-git-repo:ä»gitä»“åº“ä¸‹è½½ä»£ç 

æˆ‘ä»¬æ¥å®šä¹‰ä¸€äº›ä¸ç”¨æˆ·äº¤äº’çš„å‘½ä»¤:
```js
program
    .option('init', 'åˆå§‹åŒ–é¡¹ç›®', 'blue')
    .command('list', 'æ‰€æœ‰åˆ—è¡¨')
    .option('-c, create', 'åˆ›å»ºä¸€ä¸ªç»„ä»¶')
    .option('-j, json2ts', 'è¾“å…¥æ¥å£åœ°å€,è‡ªåŠ¨ç”ŸæˆTypeScriptç±»')
```

`.command`é‡Œé¢çš„listä¼šæ‰¾åˆ°å¯¹åº”çš„`roy-list`æ–‡ä»¶è¿›è¡Œè°ƒç”¨ã€‚

æ¥æ”¶å‘½ä»¤:
```js
program
    .usage(`${chalk.green('<cmd>')} <options>`)
    .arguments('<cmd> [env]')
    .action(function (cmd, ages) {
        const handler = bindHandler[cmd];
        if (typeof handler === 'undefined') {
            ora(chalk.red(`å‘½ä»¤${cmd}:`) + chalk.red('æš‚æœªæ”¯æŒ')).fail();
        } else {
            handler(ages);
        }
    });
```
ä½¿ç”¨ inquirer å®šä¹‰ä¸€äº›æ“ä½œ:
```js
const prompt = [
    {
        type: 'input',
        name: 'projectName',
        message: 'è¯·è¾“å…¥é¡¹ç›®å‘½å:',
        filter: function (val) {
            return val
        }
    },
    {
        type: 'list',
        name: 'jskind',
        message: 'è¯·é€‰æ‹©ä½¿ç”¨çš„æ¨¡æ¿',
        default: 0,
        choices: [
            {
                name: 'ECMAScript6',
                value: 'es6',
                url: '123'
            }, {
                name: 'TypeScript',
                value: 'ts',
                url: '456'
            }
        ]
    }
]
```

å°è£… bindHandler å¯¹å¯¹åº”çš„å‘½åå°±æ˜¯æ“ä½œ
```js
const bindHandler = {
    init() {
        inquirer.prompt(questions).then(answers => {
            projectName = answers.projectName
            const _pwd = process.cwd();
            // ç”¨æˆ·å…¨è·¯å¾„
            projectPath = `${_pwd}/${projectName}`;
            // æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨
            checkAppName(projectPath, projectName)

            const spinner = ora(`â° ${chalk.red('downloading template')}`).start();
            // é¡¹ç›®æ¨¡ç‰ˆåœ°å€
            const url = `direct:https://github.com/LiLixikun/${answers.jskind}.git`;
            // æ‰§è¡Œä¸‹è½½ä»»åŠ¡
            download(url, projectPath, { clone: true }, function (err) {
                spinner.stop();
                if (err) {
                    console.log(chalk.red('ä¸‹è½½å¤±è´¥ ğŸ˜­'));
                    process.exit(-1)
                } else {
                    spinner.succeed(`${chalk.green('ä¸‹è½½æˆåŠŸ ğŸ˜„')}`)
                    // ä¿®æ”¹é¡¹ç›®åç§°
                    shell.sed(
                        '-i',
                        'aotu',
                        projectName,
                        projectPath + '/package.json'
                    );
                }
            });

        }).catch(error => {
            console.log(chalk.red('è„šæ‰‹æ¶å‡ºç°å¼‚å¸¸,è¯·è”ç³» xx ğŸ“§'));
        })
    },
    json2ts() {
        createServer()
    }
}
```

åœ¨ç»ˆç«¯è¾“å…¥`roycli init`:

![](/modular/1610175134645.jpg)


## å‘å¸ƒnpm
é¦–å…ˆéœ€è¦åœ¨npmç½‘ç«™æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶ååœ¨é¡¹ç›®ç›®å½•ä¸‹è¾“å…¥`npm config set registry http://registry.npmjs.org`é•œåƒï¼Œå†æ‰§è¡Œ`npm login`è¾“å…¥è´¦å·ï¼Œå¯†ç ï¼Œé‚®ç®±ï¼Œæœ€åè¾“å…¥`npm publish`å®Œæˆå‘å¸ƒã€‚




