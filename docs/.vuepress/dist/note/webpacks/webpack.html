<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | 码农机器人</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="努力向前">
    
    <link rel="preload" href="/assets/css/0.styles.b8d0645b.css" as="style"><link rel="preload" href="/assets/js/app.b1af4ea7.js" as="script"><link rel="preload" href="/assets/js/2.6b359b12.js" as="script"><link rel="preload" href="/assets/js/107.a446ba7a.js" as="script"><link rel="prefetch" href="/assets/js/10.f41f6db3.js"><link rel="prefetch" href="/assets/js/100.df7da625.js"><link rel="prefetch" href="/assets/js/101.9d2465ad.js"><link rel="prefetch" href="/assets/js/102.e4beeced.js"><link rel="prefetch" href="/assets/js/103.fa0592b5.js"><link rel="prefetch" href="/assets/js/104.021c4557.js"><link rel="prefetch" href="/assets/js/105.21a26a00.js"><link rel="prefetch" href="/assets/js/106.86b39fe7.js"><link rel="prefetch" href="/assets/js/108.bc24ea29.js"><link rel="prefetch" href="/assets/js/109.261389f6.js"><link rel="prefetch" href="/assets/js/11.6efe5bf1.js"><link rel="prefetch" href="/assets/js/110.21651d6b.js"><link rel="prefetch" href="/assets/js/111.2dd0110c.js"><link rel="prefetch" href="/assets/js/112.7ff479d5.js"><link rel="prefetch" href="/assets/js/113.9390ff40.js"><link rel="prefetch" href="/assets/js/114.cf169a28.js"><link rel="prefetch" href="/assets/js/115.6d55b248.js"><link rel="prefetch" href="/assets/js/116.d2bbc48a.js"><link rel="prefetch" href="/assets/js/117.a6244126.js"><link rel="prefetch" href="/assets/js/118.1226af4b.js"><link rel="prefetch" href="/assets/js/119.e13175f8.js"><link rel="prefetch" href="/assets/js/12.c1628aee.js"><link rel="prefetch" href="/assets/js/120.0c8323bf.js"><link rel="prefetch" href="/assets/js/121.e7fdfcec.js"><link rel="prefetch" href="/assets/js/13.8412ce73.js"><link rel="prefetch" href="/assets/js/14.127c4d65.js"><link rel="prefetch" href="/assets/js/15.e0488691.js"><link rel="prefetch" href="/assets/js/16.7a57c3f3.js"><link rel="prefetch" href="/assets/js/17.0bf6db21.js"><link rel="prefetch" href="/assets/js/18.64d20eb1.js"><link rel="prefetch" href="/assets/js/19.55e1347b.js"><link rel="prefetch" href="/assets/js/20.5da9f41e.js"><link rel="prefetch" href="/assets/js/21.9512f790.js"><link rel="prefetch" href="/assets/js/22.c19cf8a6.js"><link rel="prefetch" href="/assets/js/23.9d6b679a.js"><link rel="prefetch" href="/assets/js/24.814e2cf9.js"><link rel="prefetch" href="/assets/js/25.dbe33a7c.js"><link rel="prefetch" href="/assets/js/26.e0ce754e.js"><link rel="prefetch" href="/assets/js/27.c3ca8165.js"><link rel="prefetch" href="/assets/js/28.b273411a.js"><link rel="prefetch" href="/assets/js/29.0df2d314.js"><link rel="prefetch" href="/assets/js/3.b11c314b.js"><link rel="prefetch" href="/assets/js/30.a2ce883a.js"><link rel="prefetch" href="/assets/js/31.a21ecc83.js"><link rel="prefetch" href="/assets/js/32.94bb2ba3.js"><link rel="prefetch" href="/assets/js/33.f9eef1d1.js"><link rel="prefetch" href="/assets/js/34.09d72fd9.js"><link rel="prefetch" href="/assets/js/35.0ad3136d.js"><link rel="prefetch" href="/assets/js/36.edee7554.js"><link rel="prefetch" href="/assets/js/37.15b2869e.js"><link rel="prefetch" href="/assets/js/38.2ebff2fc.js"><link rel="prefetch" href="/assets/js/39.dee2e584.js"><link rel="prefetch" href="/assets/js/4.f3783df1.js"><link rel="prefetch" href="/assets/js/40.515888ee.js"><link rel="prefetch" href="/assets/js/41.3b07166c.js"><link rel="prefetch" href="/assets/js/42.484ee502.js"><link rel="prefetch" href="/assets/js/43.0e6c3f8e.js"><link rel="prefetch" href="/assets/js/44.650bd050.js"><link rel="prefetch" href="/assets/js/45.4948d1c2.js"><link rel="prefetch" href="/assets/js/46.e69eb669.js"><link rel="prefetch" href="/assets/js/47.0ccc9bce.js"><link rel="prefetch" href="/assets/js/48.026758d5.js"><link rel="prefetch" href="/assets/js/49.7dd9214a.js"><link rel="prefetch" href="/assets/js/5.892f2cf8.js"><link rel="prefetch" href="/assets/js/50.c662aed0.js"><link rel="prefetch" href="/assets/js/51.00c96457.js"><link rel="prefetch" href="/assets/js/52.27cd93e8.js"><link rel="prefetch" href="/assets/js/53.499106ab.js"><link rel="prefetch" href="/assets/js/54.ad7c4118.js"><link rel="prefetch" href="/assets/js/55.4ff29d26.js"><link rel="prefetch" href="/assets/js/56.165cc280.js"><link rel="prefetch" href="/assets/js/57.cd639732.js"><link rel="prefetch" href="/assets/js/58.b390d324.js"><link rel="prefetch" href="/assets/js/59.e2a8bb40.js"><link rel="prefetch" href="/assets/js/6.a9a81823.js"><link rel="prefetch" href="/assets/js/60.77cd8ac6.js"><link rel="prefetch" href="/assets/js/61.e1f71481.js"><link rel="prefetch" href="/assets/js/62.f5aaf2ad.js"><link rel="prefetch" href="/assets/js/63.99996ece.js"><link rel="prefetch" href="/assets/js/64.78281a2e.js"><link rel="prefetch" href="/assets/js/65.7535c44a.js"><link rel="prefetch" href="/assets/js/66.7c9a78ab.js"><link rel="prefetch" href="/assets/js/67.8d92ff18.js"><link rel="prefetch" href="/assets/js/68.f1aae04e.js"><link rel="prefetch" href="/assets/js/69.5b78d6fb.js"><link rel="prefetch" href="/assets/js/7.a9e85c97.js"><link rel="prefetch" href="/assets/js/70.660d92fd.js"><link rel="prefetch" href="/assets/js/71.8c6b039b.js"><link rel="prefetch" href="/assets/js/72.77c1863f.js"><link rel="prefetch" href="/assets/js/73.c9ee93ce.js"><link rel="prefetch" href="/assets/js/74.951f988a.js"><link rel="prefetch" href="/assets/js/75.a2cfa812.js"><link rel="prefetch" href="/assets/js/76.986dc0d7.js"><link rel="prefetch" href="/assets/js/77.70e7f126.js"><link rel="prefetch" href="/assets/js/78.32741402.js"><link rel="prefetch" href="/assets/js/79.117093ca.js"><link rel="prefetch" href="/assets/js/8.448002b9.js"><link rel="prefetch" href="/assets/js/80.afe89fec.js"><link rel="prefetch" href="/assets/js/81.e19b0a2c.js"><link rel="prefetch" href="/assets/js/82.dc50b015.js"><link rel="prefetch" href="/assets/js/83.c9e077de.js"><link rel="prefetch" href="/assets/js/84.9e7e5753.js"><link rel="prefetch" href="/assets/js/85.b77ef75e.js"><link rel="prefetch" href="/assets/js/86.bdfb7dbb.js"><link rel="prefetch" href="/assets/js/87.6685c5bd.js"><link rel="prefetch" href="/assets/js/88.29a94e6c.js"><link rel="prefetch" href="/assets/js/89.662b9425.js"><link rel="prefetch" href="/assets/js/9.804860d0.js"><link rel="prefetch" href="/assets/js/90.71a43206.js"><link rel="prefetch" href="/assets/js/91.1bc5319e.js"><link rel="prefetch" href="/assets/js/92.94d2d420.js"><link rel="prefetch" href="/assets/js/93.73ef4162.js"><link rel="prefetch" href="/assets/js/94.784d4531.js"><link rel="prefetch" href="/assets/js/95.e3c13121.js"><link rel="prefetch" href="/assets/js/96.e2b4dcdc.js"><link rel="prefetch" href="/assets/js/97.8b804074.js"><link rel="prefetch" href="/assets/js/98.839271a0.js"><link rel="prefetch" href="/assets/js/99.42a28c45.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b8d0645b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="码农机器人" class="logo"> <span class="site-name can-hide">码农机器人</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>建立前端知识体系</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue源码分析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>提效赋能 前端工程化篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>程序员PLUS篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>构建工具</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/webpacks/webpack.html" aria-current="page" class="active sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#webpack-到底是什么呢" class="sidebar-link">Webpack 到底是什么呢？</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#项目初始化" class="sidebar-link">项目初始化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#webpack-config-js" class="sidebar-link">webpack.config.js</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#package-json" class="sidebar-link">package.json</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#mode-配置" class="sidebar-link">Mode 配置</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#source-map" class="sidebar-link">source-map</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#如何使用-source-map" class="sidebar-link">如何使用 source-map</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#分析-source-map" class="sidebar-link">分析 source-map</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#source-map-文件" class="sidebar-link">source-map 文件</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#生成-source-map" class="sidebar-link">生成 source-map</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#eval-的效果" class="sidebar-link">eval 的效果</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#eval-source-map-值" class="sidebar-link">eval-source-map 值</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#inline-source-map-值" class="sidebar-link">inline-source-map 值</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#cheap-source-map" class="sidebar-link">cheap-source-map</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#cheap-module-source-map-值" class="sidebar-link">cheap-module-source-map 值</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#cheap-source-map-和-cheap-module-source-map" class="sidebar-link">cheap-source-map 和 cheap-module-source-map</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#hidden-source-map-值" class="sidebar-link">hidden-source-map 值</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#nosources-source-map-值" class="sidebar-link">nosources-source-map 值</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#多个值的组合" class="sidebar-link">多个值的组合</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#数据分析" class="sidebar-link">数据分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#日志美化" class="sidebar-link">日志美化</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#速度分析" class="sidebar-link">速度分析</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#文件体积监控" class="sidebar-link">文件体积监控</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#编译时间优化" class="sidebar-link">编译时间优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#缩小查找范围" class="sidebar-link">缩小查找范围</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#noparse" class="sidebar-link">noParse</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#ignoreplugin" class="sidebar-link">IgnorePlugin</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#thread-loader-多进程" class="sidebar-link">thread-loader(多进程)</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#利用缓存" class="sidebar-link">利用缓存</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#编译体积优化" class="sidebar-link">编译体积优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#压缩-js-css-html-和图片" class="sidebar-link">压缩 JS，CSS，HTML 和图片</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#清除无用的-css" class="sidebar-link">清除无用的 CSS</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#tree-shaking" class="sidebar-link">Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#scope-hoisting" class="sidebar-link">Scope Hoisting</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#运行速度优化" class="sidebar-link">运行速度优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#代码分割" class="sidebar-link">代码分割</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#环境" class="sidebar-link">环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#模式-mode" class="sidebar-link">模式(mode)</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#javascript-兼容性" class="sidebar-link">JavaScript 兼容性</a></li></ul></li></ul></li><li><a href="/note/webpacks/webpack运行流程.html" class="sidebar-link">webpack运行流程</a></li><li><a href="/note/webpacks/webpack4源码.html" class="sidebar-link">webpack4源码</a></li><li><a href="/note/webpacks/手写简易webpack.html" class="sidebar-link">手写简易webpack</a></li><li><a href="/note/webpacks/webpack性能优化.html" class="sidebar-link">webpack 性能优化</a></li><li><a href="/note/webpacks/gulp.html" class="sidebar-link">Gulp</a></li><li><a href="/note/webpacks/rollup.html" class="sidebar-link">Rollup</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>知识点</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>忍者秘籍书</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> webpack</h1> <h2 id="webpack-到底是什么呢"><a href="#webpack-到底是什么呢" class="header-anchor">#</a> Webpack 到底是什么呢？</h2> <p>webpack 是一个静态的模块打包工具，为现代的 JavaScript 应用程序；</p> <ul><li>打包 bundler：webpack 可以将帮助我们进行打包，所以它是一个打包工具</li> <li>静态的 static：这样表述的原因是我们最终可以将代码打包成最终的静态资源（部署到静态服务器）；</li> <li>模块化 module：webpack 默认支持各种模块化开发，ES Module、CommonJS、AMD 等；</li> <li>现代的 modern：因为现代前端开发面临各种各样的问题，才催生了 webpack 的出现和发展；</li></ul> <p><img src="/webpacks/1695132855881.jpg" alt=""></p> <h2 id="项目初始化"><a href="#项目初始化" class="header-anchor">#</a> 项目初始化</h2> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-js extra-class"><pre class="language-js"><code>npm init <span class="token operator">-</span>y
npm install webpack webpack<span class="token operator">-</span>cli html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server cross<span class="token operator">-</span>env <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h3 id="webpack-config-js"><a href="#webpack-config-js" class="header-anchor">#</a> webpack.config.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span> <span class="token comment">//配置的模式</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span> <span class="token comment">//调试工具的选择</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//上下文目录</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//输出得路径</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//输出得文件名</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;./index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="package-json"><a href="#package-json" class="header-anchor">#</a> package.json</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="mode-配置"><a href="#mode-配置" class="header-anchor">#</a> Mode 配置</h2> <p>Mode 配置选项，可以告知 webpack 使用相应模式的内容优化:</p> <ul><li>默认值为 product(什么都不设置的情况下);</li> <li>可选值有：&quot;none&quot; | &quot;development&quot; | &quot;production&quot;</li></ul> <p>这几个选项的别：</p> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>development</td> <td>会将 DefinePlugin 中 process.env.NODE_ENV 的值设置为 development.为模块和 chunk 启用有效的名。</td></tr> <tr><td>production</td> <td>会将 DefinePlugin 中 process.env.NODE_ENV 的值设置为 production。为模块和 chunk 启用确定性的混淆名称,FlagDependencyUsageplugin ,FlagIncludedchunksplugin, ModuleConcatenationplugin , NoEmit0nErorsplugin 和 Terserplugin</td></tr> <tr><td>none</td> <td>不适用任何默认优化选项</td></tr></tbody></table> <h2 id="source-map"><a href="#source-map" class="header-anchor">#</a> source-map</h2> <p>代码通常运行在浏览器上时，是通过打包压缩的：</p> <ul><li>也就是真实跑在浏览器上的代码，和我们编写的代码其实是有差异的；</li> <li>比如 ES6 的代码可能被转换成 ES5；</li> <li>比如对应的代码行号、列号在经过编译后肯定会不一致；</li> <li>比如代码进行丑化压缩时，会将编码名称等修改；</li> <li>比如我们使用了 TypeScript 等方式编写的代码，最终转换成 JavaScript；</li></ul> <p>但是，当代码报错需要调试时（debug），调试转换后的代码是很困难的。我们不能保证代码不出错，那么如何可以调试这种转换后不一致的代码呢？答案是 source-map。</p> <ul><li>source-map 是从已转换的代码，映射到原始的源文件；</li> <li>使浏览器可以重构原始源并在调试器中显示重建的原始源；</li></ul> <h3 id="如何使用-source-map"><a href="#如何使用-source-map" class="header-anchor">#</a> 如何使用 source-map</h3> <p>如何可以使用 source-map 呢？两个步骤：</p> <ul><li>第一步：根据源文件，生成 source-map 文件，webpack 在打包时，可以通过配置生成 source-map；</li> <li>第二步：在转换后的代码，最后添加一个注释，它指向 sourcemap；</li></ul> <p>浏览器会根据我们的注释，查找相应的 source-map，并且根据 source-map 还原我们的代码，方便进行调试。</p> <p>在 Chrome 中，我们可以按照如下的方式打开 source-map：
<img src="/webpacks/1695134331012.jpg" alt=""></p> <h3 id="分析-source-map"><a href="#分析-source-map" class="header-anchor">#</a> 分析 source-map</h3> <p>最初 source-map 生成的文件大小是原始文件的 10 倍，第二版减少了约 50%，第三版又减少了 50%，所以目前一个 133kb 的文件，最终的 source-map 的大小大概在 300kb。</p> <p>目前的 source-map 长什么样子呢？</p> <ul><li>version：当前使用的版本，也就是最新的第三版；</li> <li>sources：从哪些文件转换过来的 source-map 和打包的代码（最初始的文件）；</li> <li>names：转换前的变量和属性名称（因为我目前使用的是 development 模式，所以不需要保留转换前的名称）；</li> <li>mappings：source-map 用来和源文件映射的信息（比如位置信息等），一串 base64 VLQ（veriable-length quantity 可变长度值）编码；</li> <li>file：打包后的文件（浏览器加载的文件）；</li> <li>sourceContent：转换前的具体代码信息（和 sources 是对应的关系）；</li> <li>sourceRoot：所有的 sources 相对的根目录；</li></ul> <h3 id="source-map-文件"><a href="#source-map-文件" class="header-anchor">#</a> source-map 文件</h3> <p><img src="/webpacks/1695134526100.jpg" alt=""></p> <h3 id="生成-source-map"><a href="#生成-source-map" class="header-anchor">#</a> 生成 source-map</h3> <p>如何在使用 webpack 打包的时候，生成对应的 source-map 呢？</p> <ul><li>webpack 为我们提供了非常多的选项（目前是 26 个），来处理 source-map；</li> <li>https://webpack.docschina.org/configuration/devtool/</li> <li>选择不同的值，生成的 source-map 会稍微有差异，打包的过程也会有性能的差异，可以根据不同的情况进行选择；</li></ul> <p>下面几个值不会生成 source-map</p> <ul><li>false：不使用 source-map，也就是没有任何和 source-map 相关的内容。</li> <li>none：production 模式下的默认值（什么值都不写） ，不生成 source-map。</li> <li>eval：development 模式下的默认值，不生成 source-map</li> <li>但是它会在 eval 执行的代码中，添加 //# sourceURL=；</li> <li>它会被浏览器在执行时解析，并且在调试面板中生成对应的一些文件目录，方便我们调试代码;</li></ul> <h3 id="eval-的效果"><a href="#eval-的效果" class="header-anchor">#</a> eval 的效果</h3> <p><img src="/webpacks/1695134705085.jpg" alt=""></p> <h3 id="eval-source-map-值"><a href="#eval-source-map-值" class="header-anchor">#</a> eval-source-map 值</h3> <p>eval-source-map：会生成 sourcemap，但是 source-map 是以 DataUrl 添加到 eval 函数的后面
<img src="/webpacks/1695134786489.jpg" alt=""></p> <h3 id="inline-source-map-值"><a href="#inline-source-map-值" class="header-anchor">#</a> inline-source-map 值</h3> <p>inline-source-map：会生成 sourcemap，但是 source-map 是以 DataUrl 添加到 bundle 文件的后面
<img src="/webpacks/1695134867246.jpg" alt=""></p> <h3 id="cheap-source-map"><a href="#cheap-source-map" class="header-anchor">#</a> cheap-source-map</h3> <ul><li>会生成 sourcemap，但是会更加高效一些（cheap 低开销），因为它没有生成列映射（Column Mapping）</li> <li>因为在开发中，我们只需要行信息通常就可以定位到错误了
<img src="/webpacks/1695134947551.jpg" alt=""></li></ul> <h3 id="cheap-module-source-map-值"><a href="#cheap-module-source-map-值" class="header-anchor">#</a> cheap-module-source-map 值</h3> <p>cheap-module-source-map:会生成 sourcemap，类似于 cheap-source-map，但是对源自 loader 的 sourcemap 处理会更好。</p> <p>这里有一个很模糊的概念：对源自 loader 的 sourcemap 处理会更好，官方也没有给出很好的解释</p> <blockquote><p>其实是如果 loader 对我们的源码进行了特殊的处理，比如 babel；</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&quot;babel-loader&quot;</span>l
            <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">presets</span><span class="token operator">:</span><span class="token punctuation">[</span>
                    <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span> <span class="token punctuation">,</span><span class="token punctuation">[</span> targets <span class="token operator">:</span> <span class="token string">&quot;defaults&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="cheap-source-map-和-cheap-module-source-map"><a href="#cheap-source-map-和-cheap-module-source-map" class="header-anchor">#</a> cheap-source-map 和 cheap-module-source-map</h3> <p>区别：
<img src="/webpacks/1695135203981.jpg" alt=""></p> <h3 id="hidden-source-map-值"><a href="#hidden-source-map-值" class="header-anchor">#</a> hidden-source-map 值</h3> <p>hidden-source-map：</p> <ul><li>会生成 sourcemap，但是不会对 source-map 文件进行引用；</li> <li>相当于删除了打包文件中对 sourcemap 的引用注释；
<blockquote><p>// 被删除掉的
//# sourceMappingURL=bundle.js.map</p></blockquote></li></ul> <p>如果我们手动添加进来，那么 sourcemap 就会生效了。</p> <h3 id="nosources-source-map-值"><a href="#nosources-source-map-值" class="header-anchor">#</a> nosources-source-map 值</h3> <p>nosources-source-map：会生成 sourcemap，但是生成的 sourcemap 只有错误信息的提示，不会生成源代码文件；</p> <h3 id="多个值的组合"><a href="#多个值的组合" class="header-anchor">#</a> 多个值的组合</h3> <p>事实上，webpack 提供给我们的 26 个值，是可以进行多组合的。</p> <p>组合的规则如下：</p> <ul><li>inline-|hidden-|eval：三个值时三选一；</li> <li>nosources：可选值；</li> <li>cheap 可选值，并且可以跟随 module 的值；
<blockquote><p>[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map</p></blockquote></li></ul> <p>那么在开发中，最佳的实践是什么呢？</p> <ul><li><p>开发阶段：推荐使用 source-map 或者 cheap-module-source-map</p> <p>✓ 这分别是 vue 和 react 使用的值，可以获取调试信息，方便快速开发；</p></li> <li><p>测试阶段：推荐使用 source-map 或者 cheap-module-source-map</p> <p>✓ 测试阶段我们也希望在浏览器下看到正确的错误提示；</p></li> <li><p>发布阶段：false、缺省值（不写）</p></li></ul> <h2 id="数据分析"><a href="#数据分析" class="header-anchor">#</a> 数据分析</h2> <h3 id="日志美化"><a href="#日志美化" class="header-anchor">#</a> 日志美化</h3> <ul><li>friendly-errors-webpack-plugin 可以识别某些类别得 webpack 错误，并清理，聚合和优先级，以提供更好得开发人员体验</li></ul> <h4 id="安装-2"><a href="#安装-2" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install friendly<span class="token operator">-</span>errors<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin node<span class="token operator">-</span>notifier
</code></pre></div><h4 id="webpack-config-js-2"><a href="#webpack-config-js-2" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> FriendlyErrorWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;friendly-errors-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> notifier <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;node-notifier&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">ICON</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;icon.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span> <span class="token comment">//配置的模式</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span> <span class="token comment">//调试工具的选择</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//上下文目录</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">onErrors</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">severity<span class="token punctuation">,</span> errors</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> error <span class="token operator">=</span> errors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        notifier<span class="token punctuation">.</span><span class="token function">notifier</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;webpack编译失败&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">message</span><span class="token operator">:</span> severity <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          <span class="token literal-property property">subTitle</span><span class="token operator">:</span> error<span class="token punctuation">.</span>file <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token constant">ICON</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="速度分析"><a href="#速度分析" class="header-anchor">#</a> 速度分析</h3> <ul><li>speed-measure-webpack5-plugin 可以分析打包速度</li></ul> <h4 id="安装-3"><a href="#安装-3" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install speed<span class="token operator">-</span>measure<span class="token operator">-</span>webpack5<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="webpack-config-js-3"><a href="#webpack-config-js-3" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> SpeedMeasureWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'speed-measure-webpack5-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> smw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasureWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span><span class="token string">'source-map'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="文件体积监控"><a href="#文件体积监控" class="header-anchor">#</a> 文件体积监控</h3> <ul><li>webpack-bundle-analyzer 是一个 webpack 的插件，需要配合 webpack 和 webpack-cli 一起使用，这个插件功能是生成代码分析报告，帮助提升代码指令和网站性能</li> <li>它可以直观分析打包出得文件包含哪些，大小占比如何，模块包含关系，依赖项，文件是否重复，压缩后大小如何，针对这些，我们可以进行文件分割等操作</li></ul> <h4 id="安装-4"><a href="#安装-4" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install webpack<span class="token operator">-</span>bundle<span class="token operator">-</span>analyzer <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="webpack-config-js-4"><a href="#webpack-config-js-4" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> BundleAnalyzerPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-bundle-analyzer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">//如果开启打包就启动HTTP服务器就不需要下面两个配置</span>
    <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">analyzerMode</span><span class="token operator">:</span> <span class="token string">&quot;disabled&quot;</span><span class="token punctuation">,</span> <span class="token comment">//不启动展示打包报告得HTTP服务器</span>
      <span class="token literal-property property">generateStatsFile</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//要生存stats.json文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/webpacks/1611653727254.jpg" alt=""></p> <h4 id="package-json-2"><a href="#package-json-2" class="header-anchor">#</a> package.json</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --progress&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-bundle-analyzer --port 8888 ./dist/stats.json&quot;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="编译时间优化"><a href="#编译时间优化" class="header-anchor">#</a> 编译时间优化</h2> <ul><li>减少要处理的文件</li> <li>缩小查找的范围</li></ul> <h3 id="缩小查找范围"><a href="#缩小查找范围" class="header-anchor">#</a> 缩小查找范围</h3> <h4 id="extensions"><a href="#extensions" class="header-anchor">#</a> extensions</h4> <ul><li>指定 extensions 之后可以不用在<code>require</code>或是<code>import</code>的时候加文件扩展名</li> <li>查找得时候会依次尝试添加扩展名进行匹配</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="alias"><a href="#alias" class="header-anchor">#</a> alias</h4> <ul><li>配置别名可以加快 webpack 查找模块得速度</li> <li>每当引入 bootstrap 模块的时候，它会直接引入<code>bootstrap</code>，而不需要从<code>node_modules</code>文件夹按模块的查找规则查找</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>npm install bootstrap css<span class="token operator">-</span>loader style<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">S</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> bootstrap <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
  __dirname<span class="token punctuation">,</span>
  <span class="token string">&quot;node_modules/bootstrap/dist/bootstrap.css&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span> <span class="token comment">//配置的模式</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span> <span class="token comment">//调试工具的选择</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//上下文目录</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span> bootstrap <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="modules"><a href="#modules" class="header-anchor">#</a> modules</h4> <ul><li>对于直接声明依赖名的模块 webpack 会使用类似<code>Node.js</code>一样进行路径搜索，搜索<code>node_modules</code>目录</li> <li>如果可以确定想买内所有的第三方依赖模块都是在项目根目录下的<code>node_modules</code>中的话可以直接指定</li> <li>默认配置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span><span class="token string">'.jsx'</span><span class="token punctuation">,</span><span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span><span class="token punctuation">{</span>bootstrap<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>直接指定 diff reslove:{}</li> <li>modules:{['C:/node_modules','node_modules']}</li></ul> <h4 id="mainfields"><a href="#mainfields" class="header-anchor">#</a> mainFields</h4> <ul><li>默认情况下<code>package.json</code>文件则按照文件中<code>main</code>字段的文件名来查找文件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token comment">//配置target==='web'或者target==='webworker'时mainFields默认是:</span>
    <span class="token literal-property property">mainFields</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'browser'</span><span class="token punctuation">,</span><span class="token string">'module'</span><span class="token punctuation">,</span><span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//target的值是其他时，mainFields默认值为:</span>
    <span class="token literal-property property">mainFields</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'module'</span><span class="token punctuation">,</span><span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="oneof"><a href="#oneof" class="header-anchor">#</a> oneOf</h4> <ul><li>每个文件对于 rules 中的所有规则都会遍历一遍，如果使用 oneOf 就可以解决该问题，只要能匹配一个即可退出</li> <li>在 oneOf 中不能两个匹配处理同一种类型文件</li></ul> <p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">oneOf</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//不解析node_modules</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">//thread-loader开启线程池，开线程和线程通信都需要时间</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;thread-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">workers</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">cacheDirectory</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//启动babel缓存</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="external"><a href="#external" class="header-anchor">#</a> external</h4> <ul><li>如果我们想引用一个库，但是又不想让 webpack 打包，并且又不影响我们在程序中以 CMD，AMD 或者 window/global 全局等方式进行使用，那就可以配置 externals</li></ul> <h5 id="安装-5"><a href="#安装-5" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install jquery html<span class="token operator">-</span>webpack<span class="token operator">-</span>externals<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="使用-jquery"><a href="#使用-jquery" class="header-anchor">#</a> 使用 jquery</h5> <p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> jQuery <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;jquery&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> jQuery <span class="token keyword">from</span> <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>index.html</strong></p> <p>src/index.html</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>sript src<span class="token operator">=</span><span class="token string">&quot;https://cdn.bootcss.com/jquery/3.4.1/jquery.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>sript<span class="token operator">&gt;</span>
</code></pre></div><h5 id="webpack-config-js-5"><a href="#webpack-config-js-5" class="header-anchor">#</a> webpack.config.js</h5> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">externals</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">jquery</span><span class="token operator">:</span><span class="token string">'jQuery'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="resolveloader"><a href="#resolveloader" class="header-anchor">#</a> resolveLoader</h4> <p><code>resolve.resolveLoader</code>用于配置解析 loader 时的 resolve 配置，默认的配置</p> <h5 id="logger-loader-js"><a href="#logger-loader-js" class="header-anchor">#</a> logger-loader.js</h5> <p>loaders/logger-loader.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//loader就是一个函数，接收一个内容，返回处理后的内容</span>
<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;@@@@@@@logger-loader@@@@@@@@@@&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader<span class="token punctuation">;</span>
</code></pre></div><h5 id="webpack-config-js-6"><a href="#webpack-config-js-6" class="header-anchor">#</a> webpack.config.js</h5> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> loadersPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;loader.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">resolveLoader</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span>loadersPath<span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">jquery</span><span class="token operator">:</span> <span class="token string">&quot;jQuery&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="noparse"><a href="#noparse" class="header-anchor">#</a> noParse</h3> <ul><li><code>module.noParse</code>字段，可以用于配置哪些模块文件的内容不需要进行解析</li> <li>不需要解析依赖(即无依赖)的第三方大型类库等，可以通过这个字段来配置，以提高整体的构建速度</li> <li>使用<code>noParse</code>进行忽略的模块文件中不能使用<code>import</code>,<code>require</code>等语法</li></ul> <h4 id="src-index-js"><a href="#src-index-js" class="header-anchor">#</a> src/index.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="src-title-js"><a href="#src-title-js" class="header-anchor">#</a> src/title.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><h4 id="src-name-js"><a href="#src-name-js" class="header-anchor">#</a> src/name.js</h4> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">&quot;Roy&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="webpack-config-js-7"><a href="#webpack-config-js-7" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">noParse</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">title.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//正则表达式</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ignoreplugin"><a href="#ignoreplugin" class="header-anchor">#</a> IgnorePlugin</h3> <ul><li>ignore-plugin 用于忽略某些特定的模块，让 webpack 不把这些指定的模块打包进去</li> <li>requestRegExp 匹配(test)资源请求路径的正则表达式</li> <li>contextRegExp(可选)匹配(test)资源上下文(目录)的正则表达式</li> <li>moment 会将所有本地化内容和核心功能一起打包，你可使用<code>ignorePlugin</code>,在打包时忽略本地化内容</li></ul> <h4 id="安装-6"><a href="#安装-6" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install moment <span class="token operator">-</span><span class="token constant">S</span>
</code></pre></div><h4 id="src-index-js-2"><a href="#src-index-js-2" class="header-anchor">#</a> src/index.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">&quot;moment&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moment<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="webpack-config-js-8"><a href="#webpack-config-js-8" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">resourceRegexp</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.\/locale$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//资源正则</span>
    <span class="token literal-property property">contextRegExp</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//上下文，目录正则</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="thread-loader-多进程"><a href="#thread-loader-多进程" class="header-anchor">#</a> thread-loader(多进程)</h3> <ul><li>把 thread-loader 放置在其他 loader 之前，放置在这个 loader 之后的 loader 就会在一个单独的 worker 池(worker pool)中运行</li> <li>include 表示哪些目录中的<code>.js</code>文件需要进行<code>babel-loader</code></li> <li>exclude 表示哪些目录中的<code>.js</code>文件不需要进行<code>babel-loader</code></li> <li>exclude 的优先级高于 include，尽量避免 exclude，更倾向于使用 include</li></ul> <h4 id="安装-7"><a href="#安装-7" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install thread<span class="token operator">-</span>loader babel<span class="token operator">-</span>loader @babel<span class="token operator">/</span>core @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="webpack-config-js-9"><a href="#webpack-config-js-9" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//不解析node_modules</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">//thread-loader开启线程池，开线程和线程通信都需要时间</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;thread-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">workers</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;logger-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="利用缓存"><a href="#利用缓存" class="header-anchor">#</a> 利用缓存</h3> <ul><li>利用缓存可以提升重复构建的速度</li></ul> <h4 id="babel-loader"><a href="#babel-loader" class="header-anchor">#</a> babel-loader</h4> <ul><li>Babel 在转义 js 文件过程中消耗性能较高，将 babel-loader 执行的结果缓存起来，当重新打包构建时会尝试读取缓存，从而提高构建速度，降低消耗</li> <li>默认存放位置是<code>node_modules/.cache/babel-loader</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//不解析node_modules</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token comment">//thread-loader开启线程池，开线程和线程通信都需要时间</span>
        <span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'thread-loader'</span><span class="token punctuation">,</span><span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">workers</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token punctuation">,</span><span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">cacheDirectory</span><span class="token operator">:</span><span class="token boolean">true</span> <span class="token comment">//启动babel缓存</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="cache-loader"><a href="#cache-loader" class="header-anchor">#</a> cache-loader</h4> <ul><li>在一些性能开销较大的 cache-loader 之前添加此<code>loader</code>,可以将结果缓存在磁盘中</li> <li>默认保存在<code>node_modules/.cache/cache-loader</code>目录下</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>npm install cache<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="hard-source-webpack-plugin"><a href="#hard-source-webpack-plugin" class="header-anchor">#</a> hard-source-webpack-plugin</h4> <ul><li>HardSourceWebpackPlugin 为模块提供了中间缓存，缓存默认的存放路径是<code>node_modules/.cache/hard-source</code></li> <li>配置<code>hard-source-webpack-plugin</code>后，首次构建时间并不会有太大的变化，但是从第二次开始，构建时间大约可以减少 80%左右</li> <li>webpack5 中已经内置了模块缓存，不需要再使用此插件</li></ul> <h5 id="安装-8"><a href="#安装-8" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install hard<span class="token operator">-</span>source<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="webpack-config-js-10"><a href="#webpack-config-js-10" class="header-anchor">#</a> webpack.config.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">'cache-loader'</span><span class="token punctuation">,</span>
        <span class="token string">'logger-loader'</span><span class="token punctuation">,</span>
        <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
        <span class="token string">'css-loader'</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="webpack-config-js-11"><a href="#webpack-config-js-11" class="header-anchor">#</a> webpack.config.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;hard-source-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="编译体积优化"><a href="#编译体积优化" class="header-anchor">#</a> 编译体积优化</h2> <h3 id="压缩-js-css-html-和图片"><a href="#压缩-js-css-html-和图片" class="header-anchor">#</a> 压缩 JS，CSS，HTML 和图片</h3> <ul><li>optimize-css-assets-webpack-plugin 是一个优化和压缩 CSS 资源的插件</li> <li>terser-webpack-plugin 是一个优化和压缩 JS 资源的插件</li> <li>image-webpack-loader 可以帮助我们对图片进行压缩和优化</li></ul> <h5 id="安装-9"><a href="#安装-9" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install terser<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin optimize<span class="token operator">-</span>css<span class="token operator">-</span>assets<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin image<span class="token operator">-</span>webpack<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="webpack-config-js-12"><a href="#webpack-config-js-12" class="header-anchor">#</a> webpack.config.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MinCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'min-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">minimize</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minimizer</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpg|png|gif|bmp)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>
                            <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'image-webpack-loader'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token literal-property property">mozjpeg</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token literal-property property">progressive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">optipng</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">pngquant</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.65</span><span class="token punctuation">,</span> <span class="token number">0.90</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token number">4</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">gifsicle</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token literal-property property">interlaced</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">webp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token number">75</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">minify</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">collapseWhitespace</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">removeComments</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//压缩CSS</span>

    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="清除无用的-css"><a href="#清除无用的-css" class="header-anchor">#</a> 清除无用的 CSS</h3> <ul><li>purgecss-webpack-plugin 单独提取 CSS 并清除用不到的 CSS</li></ul> <h4 id="安装-10"><a href="#安装-10" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install purgecss<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin mini<span class="token operator">-</span>css<span class="token operator">-</span>extract<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="src-index-js-3"><a href="#src-index-js-3" class="header-anchor">#</a> src/index.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;./index.css&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="src-index-css"><a href="#src-index-css" class="header-anchor">#</a> src/index.css</h4> <div class="language-js extra-class"><pre class="language-js"><code>body<span class="token punctuation">{</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span>red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
#root<span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span>red
<span class="token punctuation">}</span>
#other<span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span>green
<span class="token punctuation">}</span>
</code></pre></div><h4 id="webpack-config-js-13"><a href="#webpack-config-js-13" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//因为CSS和JS的加载可以并行，所以我们可以通过此插件提取CSS成单独的文件，然后去掉无用的CSS并进行压缩</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> PurgecssWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;purgecss-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;glob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//文件匹配模式</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">PATH</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">src</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//**匹配任意字段，包括路径分隔符，*匹配任意自动，不包含路径分隔符</span>
    <span class="token keyword">new</span> <span class="token class-name">PurgecssWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PATH</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">nodir</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> Tree Shaking</h3> <ul><li>一个模块可以有多个方法，只要其中某个方法使用到了，则整个文件都会被打到 bundle 里面去，tree shaking 就是只把用到的方法打入 bundle，没用到的方法会<code>uglify</code>阶段擦除掉</li> <li>原理是利用 es6 模块的特定，只能作为模块顶层语句出现，import 的模块名只能是字符串常量</li></ul> <h4 id="开启"><a href="#开启" class="header-anchor">#</a> 开启</h4> <ul><li>webpack 默认支持，可在 production mode 下默认开启</li> <li>在 package.json 中配置:
<ul><li>&quot;sideEffects&quot;:false 所有的代码都没有副作用(都可以进行 tree shaking)</li> <li>可能会把 css 和@babel/polyfill 文件干掉 可以设置&quot;sideEffects&quot;:[&quot;*.css&quot;]</li></ul></li></ul> <h4 id="没有导入和使用"><a href="#没有导入和使用" class="header-anchor">#</a> 没有导入和使用</h4> <p>functions.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;func1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;func2&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> func1<span class="token punctuation">,</span> func2 <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> func2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./functions&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> result2 <span class="token operator">=</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="代码不会被执行-不可到达"><a href="#代码不会被执行-不可到达" class="header-anchor">#</a> 代码不会被执行，不可到达</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="代码中只写不读的变量"><a href="#代码中只写不读的变量" class="header-anchor">#</a> 代码中只写不读的变量</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> aabbcc <span class="token operator">=</span> <span class="token string">&quot;aabbcc&quot;</span><span class="token punctuation">;</span>
aabbcc <span class="token operator">=</span> <span class="token string">&quot;eeffgg&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="scope-hoisting"><a href="#scope-hoisting" class="header-anchor">#</a> Scope Hoisting</h3> <ul><li>Scope Hoisting 可以让 webpack 打包出来的代码文件更小，运行的更快，它又译作&quot;作用域提升&quot;，是在 webpack3 中新推出的功能</li> <li>scope hoisting 的愿你是讲所有的模块按照引用顺序放在一个函数作用域里，然后适当的重命名一些变量以防止命名冲突</li> <li>这个功能在 mode 为 production 下默认开启，开发环境要用<code>webpack.optimizeModuleConcatenationPlugin</code>插件</li></ul> <p>hello.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> str <span class="token keyword">from</span> <span class="token string">&quot;./hello.js&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>main.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> hello <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'hello'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="运行速度优化"><a href="#运行速度优化" class="header-anchor">#</a> 运行速度优化</h2> <h3 id="代码分割"><a href="#代码分割" class="header-anchor">#</a> 代码分割</h3> <ul><li>对于大的 web 应用来讲，将所有的代码都放在一个文件中显然是不够有效的，特别是当你的某些代码块是在某些特殊的时候才会被用到</li> <li>webpack 有一个功能就是将你的代码库分割成 chunks 语块，当代码运行到需要它们的时候进行加载</li></ul> <h4 id="入口点分割"><a href="#入口点分割" class="header-anchor">#</a> 入口点分割</h4> <ul><li>Entry Points:入口文件设置的时候可以配置</li> <li>这种方法的问题
<ul><li>如果入口 chunks 之间包含重复的模块(lodash)，那些重复模块都会被引入到各个 bundle 中</li> <li>不够灵活，并且不能将核心应用程序逻辑进行动态拆分代码</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//mpa多页应用</span>
<span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span><span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">login</span><span class="token operator">:</span><span class="token string">&quot;./src/login.js&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="懒加载"><a href="#懒加载" class="header-anchor">#</a> 懒加载</h4> <ul><li>用户当前需要用什么功能就只加载这个功能对应的代码，也就是所谓的按需加载，在给单页应用做按需加载优化时</li> <li>一般采用以下原则:
<ul><li>对网站功能进行划分，每一类一个 chunk</li> <li>对于首次打开页面需要的功能直接加载，尽快展示给用户，某些依赖大量代码的功能点可以按需加载</li> <li>被分割出去的代码需要一个按需加载的时机</li></ul></li></ul> <h5 id="hello-js"><a href="#hello-js" class="header-anchor">#</a> hello.js</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="index-js"><a href="#index-js" class="header-anchor">#</a> index.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//渲染首页得时候先不加载hello模块，等当点击按钮得时候，才去服务器动态加载hello模块</span>
<span class="token comment">//import语法 vue react angular的懒加载组件原理是一样得</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#clickBtn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//import语句是一个天然得代码分割点。如果遇到import就会分割了去一个单独得代码块，可以单独加载</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="index-html"><a href="#index-html" class="header-anchor">#</a> index.html</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;clickBtn&quot;</span><span class="token operator">&gt;</span>点我<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre></div><h4 id="prefetch"><a href="#prefetch" class="header-anchor">#</a> prefetch</h4> <ul><li>使用预先拉取，你表示改模块可能以后会用到。浏览器会在空闲事件下载该模块</li> <li>prefetch 得作用是告诉浏览器未来可能会使用到的某个资源，浏览器就会在闲时去加载对应的资源，若能预测到用户的行为，比如懒加载，点击到其他页面等则相当于提前预加载了需要的资源</li> <li>此导入会让<code>&lt;link rel=&quot;prefetch&quot; as=&quot;script&quot; href=&quot;http://localhost:8080/hello.js&quot;&gt;</code>被添加直页面的头部，因此浏览器会在空闲时预先拉取该文件</li></ul> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#clickBtn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/*webpackChunkName:'hello',webpackPrefetch:true*/</span> <span class="token string">&quot;./hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">preload 与 prefetch 区别</p> <p>preload:预加载,此资源肯定会用到，优先较高，需要提前获取。它要慎用，有可能有性能隐患</p> <p>prefetch:预获取，此资源在以后可能会用到，它是在浏览器空闲的时候加载，没有性能问题</p></div> <h4 id="提取公共代码"><a href="#提取公共代码" class="header-anchor">#</a> 提取公共代码</h4> <ul><li>怎么配置单页应用？怎么配置多页应用？</li></ul> <h5 id="为什么需要提取公共代码"><a href="#为什么需要提取公共代码" class="header-anchor">#</a> 为什么需要提取公共代码</h5> <ul><li>大网站有多个页面，每个页面由于采用相同技术栈，会包含很多公共代码,如果都包含进来还会有问题</li> <li>相同的资源被重复的加载，浪费用户的流量和服务器的成本</li> <li>每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验</li> <li>如果能把公共代码抽离成单独文件进行加载能进行优化，可以减少网络传输流量，降低服务器成本</li></ul> <h5 id="如何提取"><a href="#如何提取" class="header-anchor">#</a> 如何提取</h5> <ul><li>基础类库，方便长期缓存</li> <li>页面之间的公用代码</li> <li>各个页面单独生成文件</li></ul> <h5 id="splitchunks"><a href="#splitchunks" class="header-anchor">#</a> splitChunks</h5> <ul><li>split-chunks-plugin</li></ul> <h5 id="module-chunk-bundle"><a href="#module-chunk-bundle" class="header-anchor">#</a> module chunk bundle</h5> <ul><li>module:就是 js 的模块化 webpack 支持 commonJS，ES6 等模块化规范，简单来说就是你通过 import 语句引入的代码</li> <li>chunk:chunk 是 webpack 根据功能拆分出来的，包含三种情况
<ul><li>你得项目入口(entry)</li> <li>通过 import()动态引入的代码</li> <li>通过 splitChunks 拆分出来的代码</li></ul></li> <li>bundle:bundle 是 webpack 打包之后的各个文件，一般就是和 chunk 是一对一的关系，bundle 就是兑 chunk 进行编译压缩打包等处理之后的产出</li></ul> <p><img src="/webpacks/1611731367206.jpg" alt=""></p> <p><strong>page1.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> module1 <span class="token keyword">from</span> <span class="token string">&quot;./module1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> module2 <span class="token keyword">from</span> <span class="token string">&quot;./module2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module1<span class="token punctuation">,</span> module2<span class="token punctuation">,</span> $<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: 'asyncModule1'*/</span> <span class="token string">&quot;./asyncModule1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>page2.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> module1 <span class="token keyword">from</span> <span class="token string">&quot;./module1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> module2 <span class="token keyword">from</span> <span class="token string">&quot;./module2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module1<span class="token punctuation">,</span> module2<span class="token punctuation">,</span> $<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>page3.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> module1 <span class="token keyword">from</span> <span class="token string">&quot;./module1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> module2 <span class="token keyword">from</span> <span class="token string">&quot;./module3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module1<span class="token punctuation">,</span> module3<span class="token punctuation">,</span> $<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>module1.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;module1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>module2.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;module2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>module3.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;module3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">page1</span><span class="token operator">:</span><span class="token string">'./src/page1.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">page2</span><span class="token operator">:</span><span class="token string">'./src/page2.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">page3</span><span class="token operator">:</span><span class="token string">'./src/page3.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//initial 入口chunk，对于异步导入的文件不处理</span>
        <span class="token comment">// async 异步chunk，只对异步导入的文件处理</span>
        <span class="token comment">// all 全部chunk</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span><span class="token comment">//默认只分割异步模块</span>
        <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//分割出去的代码块的最小体积，0表示不限制</span>
        <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//分割出去的代码块的最大体积，0表示不限制</span>
        <span class="token literal-property property">minRemainingSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//分割后剩下体积 0表示不限制 webpack5新添的参数</span>
        <span class="token comment">//minChunks: 1,//如果此模块被多个入口引用几次会被分割</span>
        <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span><span class="token comment">//异步请求最大分割出去几个代码块</span>
        <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span><span class="token comment">//同步时最大分割出去几个代码块</span>
        <span class="token literal-property property">automaticNameDelimiter</span><span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span><span class="token comment">//名称的分隔符</span>
        <span class="token literal-property property">enforceSizeThreshold</span><span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span><span class="token comment">//强制阈值 新增加的参数</span>
        <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//缓存组配置 配置如何对模块分组相同分组会分到一个代码块中</span>
            <span class="token literal-property property">defaultVendors</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//第三方模块</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//如果模块的路径匹配此正则的话</span>
                <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token comment">//很多缓存组，如果一个模块同属于多个缓存组，应该分到哪个组里，看优先级高</span>
                <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token comment">//是否可复用现有的代码块</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//此模块最几个入口引用过,最少2个才取提取</span>
                <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
                <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">'page1.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'page1'</span><span class="token punctuation">]</span><span class="token comment">//往HTML页面里播放哪些资源文件(bundle)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">'page2.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'page2'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">'page3.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'page3'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="环境"><a href="#环境" class="header-anchor">#</a> 环境</h2> <h3 id="模式-mode"><a href="#模式-mode" class="header-anchor">#</a> 模式(mode)</h3> <ul><li>日常的前端开发工作中，一般都会又两套构建环境</li> <li>一套开发时使用，构建结果用于本地开发调试，不进行代码压缩，打印 debug 信息，包含 sourcemap 文件</li> <li>一套构建后的结果是直接应用于线上的，即代码都是压缩后，运行时不打印 debug 信息，静态文件不包括 sourcemap</li> <li>webpack 4.x 引入了 mode 的概念</li> <li>当你指定使用 production mode 时，默认会启用各种性能优化的功能，包括构建结果优化以及 webpack 运行性能优化</li> <li>而如果时 development mode 的话，则会开启 debug 工具，运行时打印详细的错误信息，以及更加快读的增量编译构建</li></ul> <table><thead><tr><th>构建</th> <th>描述</th></tr></thead> <tbody><tr><td>development</td> <td>会讲 process.env.NODE_ENV 的值设为 development,启用 NamedChunksPlugin 和 NamedModulesPlugin</td></tr> <tr><td>production</td> <td>会讲 process.env.NODE_ENV 的值设置为 production，启用 FlagDependencyUsagePlugin,FlagIncludedChunksPlugin,ModuleConcatenationPlugin,NoEmitOnErrorsPlugin,OccurrenceOrderPlugin,SideEffectsFlagPlugin 和 UglifyJsPlugin</td></tr></tbody></table> <h4 id="环境差异"><a href="#环境差异" class="header-anchor">#</a> 环境差异</h4> <ul><li>开发环境
<ul><li>需要生成 sourcemap 文件</li> <li>需要打印 debug 信息</li> <li>需要 live reload 或者 hot reload 的功能</li></ul></li> <li>生产环境
<ul><li>可能需要分离 CSS 成单独的文件，以便多个页面共享同一个 CSS 文件</li> <li>需要压缩 HTML/CSS/JS 代码</li> <li>需要压缩图片</li></ul></li> <li>其默认值为 production</li></ul> <h4 id="区分环境"><a href="#区分环境" class="header-anchor">#</a> 区分环境</h4> <ul><li>--mode 用来设置模块内的 process.env.NODE_ENV</li> <li>--env 用来设置 webpack 配置文件的函数参数</li> <li>cross-env 用来设置 node 环境的 process.env.NODE_ENV</li> <li>dotenv 可以按需加载不同的环境变量文件</li> <li>define-plugin 用来配置在 <strong>编译时候</strong> 用的 <strong>全局常量</strong></li></ul> <h5 id="安装-11"><a href="#安装-11" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install cross<span class="token operator">-</span>env dotenv terser<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin optimize<span class="token operator">-</span>css<span class="token operator">-</span>assets<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="mode-默认值"><a href="#mode-默认值" class="header-anchor">#</a> mode 默认值</h5> <ul><li>webpack 的 mode 默认为 production</li> <li>webpack serve 的 mode 默认为 development</li> <li>可以在模块内通过 process.env.NODE_ENV 获取当前的环境变量，无法在 webpack 配置文件中获取此变量</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//development | production</span>
</code></pre></div><h5 id="命令行传-mode"><a href="#命令行传-mode" class="header-anchor">#</a> 命令行传 mode</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=production&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=development serve&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="命令行配置-env"><a href="#命令行配置-env" class="header-anchor">#</a> 命令行配置 env</h5> <ul><li>无法在模块内通过 process.env.NODE_ENV 访问</li> <li>可以通过 webpack 配置文件中通过函数获取当前环境变量</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=production&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=development serve&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;optimize-css-assets-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;terser-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">minimize</span><span class="token operator">:</span> env <span class="token operator">&amp;&amp;</span> env<span class="token punctuation">.</span>production<span class="token punctuation">,</span>
      <span class="token literal-property property">minimizer</span><span class="token operator">:</span>
        env <span class="token operator">&amp;&amp;</span> env<span class="token punctuation">.</span>production
          <span class="token operator">?</span> <span class="token punctuation">[</span>
              <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//开启多进程并行压缩</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span>
          <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="mode-配置-2"><a href="#mode-配置-2" class="header-anchor">#</a> mode 配置</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="defineplugin"><a href="#defineplugin" class="header-anchor">#</a> DefinePlugin</h5> <ul><li>设置全局变量(不是<code>window</code>)，所有模块都能读取到该变量的值</li> <li>可以在任意模块内通过<code>process.env.NODE_ENV</code>获取当前的环境变量</li> <li>但无法在<code>node环境</code>(wenpack 配置文件中)下获取当前的环境变量</li></ul> <p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;process.env.NODE_ENV&quot;</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;NODE_ENV&quot;</span><span class="token punctuation">,</span> <span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//error</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">//定义在编译使用的全局变量，在浏览器运行阶段就只是值了</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string-property property">&quot;process.env.NODE_ENV&quot;</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&quot;development&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//注意用双引号引起了，否则就变成变量了</span>
      <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>src/index.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">NODE</span><span class="token punctuation">.</span><span class="token constant">ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//production</span>
</code></pre></div><p><strong>src/logger.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">logger</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="cross-env"><a href="#cross-env" class="header-anchor">#</a> cross-env</h5> <p>.env</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> development<span class="token punctuation">;</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//可以读取.env文件，获取里面的值，设置到process.env.NODE_ENV里面</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;dotenv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;webpack.config.js process.env.NODE_ENV&quot;</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="javascript-兼容性"><a href="#javascript-兼容性" class="header-anchor">#</a> JavaScript 兼容性</h3> <h4 id="babel"><a href="#babel" class="header-anchor">#</a> Babel</h4> <ul><li>Babel 是一个 JavaScript 编译器</li> <li>Babel 是一个工具链，主要用于讲 ECMAScript 2015+版本的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其他环境中</li> <li>Babel 能为你做的事
<ul><li>语法转换</li></ul></li></ul> <h5 id="安装-12"><a href="#安装-12" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install @babel<span class="token operator">/</span>core @babel<span class="token operator">/</span>cli <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="命令行使用"><a href="#命令行使用" class="header-anchor">#</a> 命令行使用</h5> <p><strong>src/index.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>package.json</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel src --out-dir dist&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="插件"><a href="#插件" class="header-anchor">#</a> 插件</h4> <ul><li>Babel 是一个编译器(输入源码=&gt;输出编译后的代码)。就像其他编译器一样，编译过程分为三个阶段:解析、转换和打印输出</li> <li>现在，Babel 虽然开箱即用，但是什么动作都不做，它基本上类似于<code>const babel=code=&gt;code;</code>，讲代码解析之后在输出同样的代码。如果想要 Babel 做一些实际的工作，就需要其添加插件。</li></ul> <h5 id="安装-13"><a href="#安装-13" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span>arrow<span class="token operator">-</span>functions <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="babelrc"><a href="#babelrc" class="header-anchor">#</a> .babelrc</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;plugins&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-transform-arrow-functions&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="预设"><a href="#预设" class="header-anchor">#</a> 预设</h4> <ul><li>@babel/preset-env 可以让你使用最新的 JavaScript 语法，而不需要去管理语法转换器(并且可选的支持目标浏览器环境的 polyfills)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pluginA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pluginB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pluginC&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="安装-14"><a href="#安装-14" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env
</code></pre></div><h5 id="babelrc-2"><a href="#babelrc-2" class="header-anchor">#</a> .babelrc</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="browsers"><a href="#browsers" class="header-anchor">#</a> browsers</h5> <ul><li>@babel/preset-env 会根据你配置的目标环境，生成插件列表来编译</li> <li>可以使用.browserslistrc 文件来指定目标环境</li> <li>browserslist 详细配置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//.browserslistrc</span>
<span class="token operator">&gt;</span><span class="token number">0.25</span><span class="token operator">%</span>
not head
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>last <span class="token number">2</span> Chrome versions
</code></pre></div><h4 id="polifill"><a href="#polifill" class="header-anchor">#</a> polifill</h4> <ul><li>@babel/preset-env 默认只转换新的 JavaScript 语法，而不转换新的 API，比如 Iterator,Generator,Set,Maps,Proxy,Reflect,Symbol,Promise 等全局对象。以及一些在全局对象上的方法(比如 Object.assign)都不会转码</li> <li>比如说，ES6 在 Array 对象上新增了 Array.from 方法，Babel 就不会转码这个方法，如果想让这个方法运行，必须使用 babel-polyfill 来转换等。</li> <li>polyfill 的中文意思是垫片，所谓垫片不同浏览器或者不同环境下的差异，让新的内置函数，实例方法等在低版本浏览器中也可以使用</li> <li>官方给出@babel/polyfill 和 babel-runtime 两种解决方案来解决这种全局对象或全局对象方法不足的问题</li> <li>babel-runtime 适合在组件和类库项目中使用，而 babel-polyfill 适合在业务项目中使用</li></ul> <h5 id="polyfill"><a href="#polyfill" class="header-anchor">#</a> polyfill</h5> <ul><li>@babel/polyfill 模块可以模拟完整的 ES2015+环境</li> <li>这意味着可以使用诸如 Promise 和 WeakMap 之类的新的内置对象，Array.from 或 Object.assign 之类的静态方法，Array.prototype.includes 之类的实例方法以及生成器函数</li> <li>它是通过向全局对象和内置对象的 prototype 上添加方法来实现的。比如运行环境中不支持 Array.prototype.find 方法，引入 polyfill，我们就可以使用 es6 方法来编写了，但是缺点就是会造成全局空间污染</li> <li>V7.4.0 版本开始,@babel/polyfill 已经被废弃</li></ul> <h5 id="安装-15"><a href="#安装-15" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">--</span>save @babel<span class="token operator">/</span>polyfill core<span class="token operator">-</span>js@<span class="token number">3</span>
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli babel<span class="token operator">-</span>loader
</code></pre></div><h5 id="usebuiltins-fase"><a href="#usebuiltins-fase" class="header-anchor">#</a> useBuiltIns:fase</h5> <ul><li>&quot;useBuiltIns:false&quot;此时不对 polyfill 做操做。如果引入@babel/polyfill,则无视配置的浏览器兼容,引入所有的 polyfill</li></ul> <p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//输出的路径</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//输出的文件名</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">[</span>
                <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                  <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>package.json</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel src --out-dir dist --watch&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;pack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=development&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="usebuiltins-entry"><a href="#usebuiltins-entry" class="header-anchor">#</a> useBuiltIns:entry</h5> <ul><li>&quot;useBuiltIns&quot;:&quot;entry&quot;根据配置的浏览器兼容，引入浏览器不兼容的 polyfill。需要在入口文件手动添加<code>import '@babel/polyfill'</code>，会自动根据 browserslist 替换成浏览器不兼容的所有 polyfill</li> <li>这里需要指定 core-js 的版本，如果&quot;corejs&quot;:3,则<code>import '@babel/polyfill'</code>需要改成<code>import 'core-js';import 'regenerator-runtime/runtime'</code></li> <li><code>core-js@2</code>分支中已经不会在添加新特性，新特性都会添加到<code>core-js@3</code>，比如<code>Array.prototype.flat()</code></li></ul> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span><span class="token string">'entry'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">corejs</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">targets</span><span class="token operator">:</span><span class="token string">&quot;last 2 Chrome versions&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">]</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;core-js/stable&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;regenerator-runtime/runtime&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="usebuiltins-usage"><a href="#usebuiltins-usage" class="header-anchor">#</a> useBuiltIns:usage</h5> <ul><li>&quot;useBuiltIns&quot;:&quot;usage&quot; usage 会根据配置的浏览器兼容，以及你代码中用到的 API 来进行 polyfill，实现了按需添加</li></ul> <p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span><span class="token string">'usage'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">corejs</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">targets</span><span class="token operator">:</span><span class="token string">&quot;&gt;0.25%,not dead&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">]</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>dist/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;core-js/stable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;regenerator-runtime/runtime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="babel-runtime"><a href="#babel-runtime" class="header-anchor">#</a> babel-runtime</h4> <ul><li>Babel 为了解决全局空间污染问题，提供了单独的包 babel-runtime 用以提供编译模块的工具函数</li> <li>简单的说<code>babel-runtime</code>更像是一种按需加载的实现，比如你哪里需要使用 Promise，只要在这个文件头部<code>require Promise from 'bable-runtime/core-js/promise'</code>就行了</li></ul> <h5 id="安装-16"><a href="#安装-16" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install babel<span class="token operator">-</span>runtime <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="src-index-js-4"><a href="#src-index-js-4" class="header-anchor">#</a> src/index.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Promise <span class="token keyword">from</span> <span class="token string">&quot;babel-runtime/core-js/promise&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="webpack-config-js-14"><a href="#webpack-config-js-14" class="header-anchor">#</a> webpack.config.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="header-anchor">#</a> babel-plugin-transform-runtime</h4> <ul><li>启用插件<code>babel-plugin-transform-runtime</code>后，Babel 就会使用<code>babel-runtime</code>下的工具函数</li> <li><code>babel-plugin-transform-runtime</code>插件能够将这些工具函数的代码转换成<code>require</code>语句,指向为对<code>babel-runtime</code>的引用</li> <li><code>babel-plugin-transform-runtime</code>就是可以在我们使用新 API 时自动<code>import babel-runtime</code>里面的 polyfill
<ul><li>当我们使用 async/await 时，自动引入<code>babel-runtime/regenerator</code></li> <li>当我们使用 ES6 的静态事件或内置对象时，自动引入<code>babel-runtime/core-js</code></li> <li>移除内联<code>babel helpers</code>并替换使用<code>babel-runtime/helpers</code>来替换</li></ul></li> <li><code>babel-plugin-transform-runtime</code>自带的是<code>core-js@3</code>，如果配置 corejs 配置为 2 需要单独安装<code>@babel/runtime-corejs2</code></li> <li><code>@babel/polyfill</code>自带的<code>core-js@2</code>，如果配置 corejs 配置为 3，需要单独安装<code>core-js@3</code></li> <li><code>@babel/plugin-transform-runtime</code>可以减少编译后代码的提交外，我们使用它还有一个好处，它可以为代码创建一个沙盒环境，如果使用<code>@babel/polyfill</code>及其提供的内置程序(例如 Promise，Set 和 Map)，则它们将污染全局范围，虽然这对于应用程序或命令行工具可能时可以的，但是如果你得代码是要发布供其他人使用的库，或者无法完全控制代码运行的环境，则将成为一个问题</li></ul> <h5 id="安装-17"><a href="#安装-17" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span>runtime @babel<span class="token operator">/</span>runtime<span class="token operator">-</span>corejs2 @babel<span class="token operator">/</span>runtime<span class="token operator">-</span>corejs3 <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="webpack-config-js-15"><a href="#webpack-config-js-15" class="header-anchor">#</a> webpack.config.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span><span class="token string">'usage'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">corejs</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">targets</span><span class="token operator">:</span><span class="token string">&quot;&gt;0.25%,not dead&quot;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">]</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token punctuation">[</span>
                            <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span>
                            <span class="token punctuation">{</span>
                                <span class="token literal-property property">corejs</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//当我们使用ES6的静态事件或内置对象时自动引入babel-runtime/core-js</span>
                                <span class="token literal-property property">helpers</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//移除内联babel helpers并替换使用babel-runtime/helpers来替换</span>
                                <span class="token literal-property property">regenerator</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//是否开启regenerator函数转换或使用regenerator runtime来避免污染全局域</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token string">'@babel/plugin-proposal-decorators'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">legacy</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token string">'@babel/plugin-proposal-class-properties'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">loose</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//corejs</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//helpers</span>
<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//regenerator</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="执行顺序"><a href="#执行顺序" class="header-anchor">#</a> 执行顺序</h5> <ul><li>插件在 Presets 前运行</li> <li>插件属性从前往后排列</li> <li>presets 顺序从后往前</li></ul> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin1 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;plugin1.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin2 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;plugin2.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin3 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;plugin3.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin4 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;plugin4.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin5 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;plugin5.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin6 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;plugin6.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">preset1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>plugin5<span class="token punctuation">,</span> plugin6<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">preset2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>plugin3<span class="token punctuation">,</span> plugin4<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//plugins: [plugin1,plugin2],</span>
<span class="token comment">//presets: [preset1,preset2]</span>
<span class="token comment">//插件先执行预设后执行</span>
<span class="token comment">//插件是从前往后</span>
<span class="token comment">//预设是从后往前</span>
<span class="token comment">//plugin1,plugin2 plugin3,plugin4 plugin5,plugin6</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;inline-source-map&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>plugin1<span class="token punctuation">,</span> plugin2<span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>preset1<span class="token punctuation">,</span> preset2<span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">9/19/2023, 10:58:49 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/http/http基础.html" class="prev">
        http 基础
      </a></span> <span class="next"><a href="/note/webpacks/webpack运行流程.html">
        webpack运行流程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.b1af4ea7.js" defer></script><script src="/assets/js/2.6b359b12.js" defer></script><script src="/assets/js/107.a446ba7a.js" defer></script>
  </body>
</html>
