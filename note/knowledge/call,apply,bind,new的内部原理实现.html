<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>call,apply,bind,new的内部原理实现 | 码农机器人</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="努力向前">
    <link rel="preload" href="/assets/css/0.styles.36f06804.css" as="style"><link rel="preload" href="/assets/js/app.e348a179.js" as="script"><link rel="preload" href="/assets/js/2.8fa949b0.js" as="script"><link rel="preload" href="/assets/js/40.bd24e6ed.js" as="script"><link rel="prefetch" href="/assets/js/10.ed293fac.js"><link rel="prefetch" href="/assets/js/100.d85ca124.js"><link rel="prefetch" href="/assets/js/101.6c2fe464.js"><link rel="prefetch" href="/assets/js/102.fedb86a5.js"><link rel="prefetch" href="/assets/js/103.bcf65284.js"><link rel="prefetch" href="/assets/js/104.568503e2.js"><link rel="prefetch" href="/assets/js/105.85fda5ee.js"><link rel="prefetch" href="/assets/js/11.ced22967.js"><link rel="prefetch" href="/assets/js/12.867f53bf.js"><link rel="prefetch" href="/assets/js/13.1818e600.js"><link rel="prefetch" href="/assets/js/14.1d921789.js"><link rel="prefetch" href="/assets/js/15.63c6b624.js"><link rel="prefetch" href="/assets/js/16.97504e73.js"><link rel="prefetch" href="/assets/js/17.cf7b05ba.js"><link rel="prefetch" href="/assets/js/18.162e03d1.js"><link rel="prefetch" href="/assets/js/19.197a410b.js"><link rel="prefetch" href="/assets/js/20.e39f6d6f.js"><link rel="prefetch" href="/assets/js/21.30b35824.js"><link rel="prefetch" href="/assets/js/22.5f135ac3.js"><link rel="prefetch" href="/assets/js/23.fe0780f1.js"><link rel="prefetch" href="/assets/js/24.9b34eda5.js"><link rel="prefetch" href="/assets/js/25.0f45dd0a.js"><link rel="prefetch" href="/assets/js/26.638591ac.js"><link rel="prefetch" href="/assets/js/27.522fbfac.js"><link rel="prefetch" href="/assets/js/28.cca98502.js"><link rel="prefetch" href="/assets/js/29.5c5a9dac.js"><link rel="prefetch" href="/assets/js/3.6421eb0c.js"><link rel="prefetch" href="/assets/js/30.15bab7f6.js"><link rel="prefetch" href="/assets/js/31.683c21e6.js"><link rel="prefetch" href="/assets/js/32.d334de35.js"><link rel="prefetch" href="/assets/js/33.29d19670.js"><link rel="prefetch" href="/assets/js/34.d4858338.js"><link rel="prefetch" href="/assets/js/35.bf5e3504.js"><link rel="prefetch" href="/assets/js/36.802016a5.js"><link rel="prefetch" href="/assets/js/37.df71e35e.js"><link rel="prefetch" href="/assets/js/38.6be03228.js"><link rel="prefetch" href="/assets/js/39.764fdaf3.js"><link rel="prefetch" href="/assets/js/4.6f69a0ec.js"><link rel="prefetch" href="/assets/js/41.f953c67e.js"><link rel="prefetch" href="/assets/js/42.d6cdc00a.js"><link rel="prefetch" href="/assets/js/43.aa53fa78.js"><link rel="prefetch" href="/assets/js/44.13b157d3.js"><link rel="prefetch" href="/assets/js/45.d8b620f5.js"><link rel="prefetch" href="/assets/js/46.6b3923dd.js"><link rel="prefetch" href="/assets/js/47.6b527201.js"><link rel="prefetch" href="/assets/js/48.a1615868.js"><link rel="prefetch" href="/assets/js/49.e25e5d8b.js"><link rel="prefetch" href="/assets/js/5.29fae726.js"><link rel="prefetch" href="/assets/js/50.9e7c9041.js"><link rel="prefetch" href="/assets/js/51.a4bcd1c6.js"><link rel="prefetch" href="/assets/js/52.b450e759.js"><link rel="prefetch" href="/assets/js/53.59d21714.js"><link rel="prefetch" href="/assets/js/54.04000b77.js"><link rel="prefetch" href="/assets/js/55.9eaae0ab.js"><link rel="prefetch" href="/assets/js/56.adef4f7b.js"><link rel="prefetch" href="/assets/js/57.34dcad13.js"><link rel="prefetch" href="/assets/js/58.2fe21cad.js"><link rel="prefetch" href="/assets/js/59.122e056f.js"><link rel="prefetch" href="/assets/js/6.6a9558d6.js"><link rel="prefetch" href="/assets/js/60.d09eed6d.js"><link rel="prefetch" href="/assets/js/61.60f2c51d.js"><link rel="prefetch" href="/assets/js/62.4de510d7.js"><link rel="prefetch" href="/assets/js/63.8559df13.js"><link rel="prefetch" href="/assets/js/64.5c7b323e.js"><link rel="prefetch" href="/assets/js/65.47748ed8.js"><link rel="prefetch" href="/assets/js/66.ed05a221.js"><link rel="prefetch" href="/assets/js/67.717ddeab.js"><link rel="prefetch" href="/assets/js/68.e4009000.js"><link rel="prefetch" href="/assets/js/69.b908eff3.js"><link rel="prefetch" href="/assets/js/7.20ebb3ce.js"><link rel="prefetch" href="/assets/js/70.223932fc.js"><link rel="prefetch" href="/assets/js/71.614008b2.js"><link rel="prefetch" href="/assets/js/72.fa3d06f9.js"><link rel="prefetch" href="/assets/js/73.c888b8eb.js"><link rel="prefetch" href="/assets/js/74.1e73fca1.js"><link rel="prefetch" href="/assets/js/75.6329c2bd.js"><link rel="prefetch" href="/assets/js/76.1d3eab59.js"><link rel="prefetch" href="/assets/js/77.b04c7e94.js"><link rel="prefetch" href="/assets/js/78.16ef7240.js"><link rel="prefetch" href="/assets/js/79.5a4017d5.js"><link rel="prefetch" href="/assets/js/8.34110c5a.js"><link rel="prefetch" href="/assets/js/80.2fc9daad.js"><link rel="prefetch" href="/assets/js/81.dec537b9.js"><link rel="prefetch" href="/assets/js/82.77d82d30.js"><link rel="prefetch" href="/assets/js/83.a87cdcbd.js"><link rel="prefetch" href="/assets/js/84.7f5ae216.js"><link rel="prefetch" href="/assets/js/85.3f076828.js"><link rel="prefetch" href="/assets/js/86.9d802052.js"><link rel="prefetch" href="/assets/js/87.5ba18346.js"><link rel="prefetch" href="/assets/js/88.ae404626.js"><link rel="prefetch" href="/assets/js/89.3617ee9e.js"><link rel="prefetch" href="/assets/js/9.9450eba1.js"><link rel="prefetch" href="/assets/js/90.3a65237c.js"><link rel="prefetch" href="/assets/js/91.95706bfb.js"><link rel="prefetch" href="/assets/js/92.a1c5d858.js"><link rel="prefetch" href="/assets/js/93.b2f7e58b.js"><link rel="prefetch" href="/assets/js/94.d4b365b4.js"><link rel="prefetch" href="/assets/js/95.a0c50c19.js"><link rel="prefetch" href="/assets/js/96.cfc90964.js"><link rel="prefetch" href="/assets/js/97.153af19f.js"><link rel="prefetch" href="/assets/js/98.43865ae1.js"><link rel="prefetch" href="/assets/js/99.cfbf9725.js">
    <link rel="stylesheet" href="/assets/css/0.styles.36f06804.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="码农机器人" class="logo"> <span class="site-name can-hide">码农机器人</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>建立前端知识体系</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/handwritten/手写.html" class="sidebar-link">手写</a></li><li><a href="/note/knowledge/JS数据类型.html" class="sidebar-link">JS数据类型</a></li><li><a href="/note/knowledge/变量、作用域、内存问题.html" class="sidebar-link">变量、作用域、内存问题</a></li><li><a href="/note/knowledge/复杂数据类型.html" class="sidebar-link">复杂数据类型</a></li><li><a href="/note/knowledge/JS原型-原型链.html" class="sidebar-link">JS原型-原型链</a></li><li><a href="/note/knowledge/函数表达式.html" class="sidebar-link">函数表达式</a></li><li><a href="/note/knowledge/事件循环机制EventLoop.html" class="sidebar-link">事件循环机制EventLoop</a></li><li><a href="/note/knowledge/深拷贝、浅拷贝.html" class="sidebar-link">深拷贝、浅拷贝</a></li><li><a href="/note/knowledge/迭代器.html" class="sidebar-link">迭代器</a></li><li><a href="/note/knowledge/tcp.html" class="sidebar-link">TCP三次握手，四次挥手</a></li><li><a href="/note/knowledge/HTTPS和HTTP2.0.html" class="sidebar-link">HTTPS和HTTP2.0</a></li><li><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html" class="active sidebar-link">call,apply,bind,new的内部原理实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#function-prototype-call" class="sidebar-link">Function.prototype.call()</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#call可以继承" class="sidebar-link">call可以继承</a></li><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#call方法调用匿名函数" class="sidebar-link">call方法调用匿名函数</a></li><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#call方法指定上下文的this" class="sidebar-link">call方法指定上下文的this</a></li><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#call原理" class="sidebar-link">call原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#function-prototype-apply" class="sidebar-link">Function.prototype.apply()</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#apply-将数组添加到另一个数组" class="sidebar-link">apply 将数组添加到另一个数组</a></li><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#apply-找出最大值和最小值" class="sidebar-link">apply 找出最大值和最小值</a></li><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#apply原理" class="sidebar-link">apply原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#function-prototype-bind" class="sidebar-link">Function.prototype.bind()</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#创建绑定函数" class="sidebar-link">创建绑定函数</a></li><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#偏函数" class="sidebar-link">偏函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#bind原理" class="sidebar-link">bind原理</a></li><li class="sidebar-sub-header"><a href="/note/knowledge/call,apply,bind,new的内部原理实现.html#new的原理" class="sidebar-link">new的原理</a></li></ul></li><li><a href="/note/knowledge/JavaScript工作原理.html" class="sidebar-link">JavaScript工作原理</a></li><li><a href="/note/knowledge/元编程.html" class="sidebar-link">元编程</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue源码分析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>提效赋能 前端工程化篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>全栈赋能 Node篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>程序员PLUS篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>习题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>忍者秘籍书</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="call-apply-bind-new的内部原理实现"><a href="#call-apply-bind-new的内部原理实现" class="header-anchor">#</a> call,apply,bind,new的内部原理实现</h1> <h2 id="function-prototype-call"><a href="#function-prototype-call" class="header-anchor">#</a> Function.prototype.call()</h2> <p><code>call()</code>方法调用一个函数，其具有一个指定的this值和分别提供的参数</p> <p>该方法和<code>apply()</code>类似，区别在于，<code>call()</code>可以接受若干参数，而<code>apply()</code>接收的是一个包含多个参数的数组。</p> <p>语法:<code>fun.call(thisArg, arg1, arg2, ...)</code></p> <h3 id="call可以继承"><a href="#call可以继承" class="header-anchor">#</a> call可以继承</h3> <p>通过父类的构造函数call方法实现继承</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Product</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Food</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Product</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>category <span class="token operator">=</span> <span class="token string">'food'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> cheese <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Food</span><span class="token punctuation">(</span><span class="token string">'feta'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cheese<span class="token punctuation">)</span>
<span class="token comment">// Food { name: 'feta', price: 5, category: 'food' }</span>

</code></pre></div><p>实例都会拥有在Product构造函数中添加的name属性和price属性，但category属性是在各自的构造函数中定义的。</p> <h3 id="call方法调用匿名函数"><a href="#call方法调用匿名函数" class="header-anchor">#</a> call方法调用匿名函数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> animals <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> species<span class="token operator">:</span> <span class="token string">'Lion'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'King'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> species<span class="token operator">:</span> <span class="token string">'Whale'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Fail'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> animals<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'#'</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>species <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>animals<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>for循环体内，我们创建了一个匿名函数，然后通过调用该函数的call方法，将每个数组元素作为指定的this值执行了那个匿名函数。</p> <h3 id="call方法指定上下文的this"><a href="#call方法指定上下文的this" class="header-anchor">#</a> call方法指定上下文的this</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> reply <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>animal<span class="token punctuation">,</span> <span class="token string">'typically sleep between'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleepDuration<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  animal<span class="token operator">:</span> <span class="token string">'cats'</span><span class="token punctuation">,</span> sleepDuration<span class="token operator">:</span> <span class="token string">'12 and 16 hours'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">greet</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// cats typically sleep between 12 and 16 hours</span>

</code></pre></div><h3 id="call原理"><a href="#call原理" class="header-anchor">#</a> call原理</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myCall</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 第一个参数为 this 指向值，如无则指向 window</span>
    context <span class="token operator">=</span> context<span class="token operator">?</span><span class="token function">Object</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token operator">:</span>window
    <span class="token comment">// 将本身的函数保存下来，在后面需要执行，这一步 this 的指向已经指向了 context </span>
    context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token comment">// 将后面传入的参数转为数组，取除第一个 this 指向剩下的所有参数</span>
    <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">// 执行函数本身，并将参数传入</span>
    <span class="token keyword">let</span> r <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 销毁函数，避免作用域污染</span>
    <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>

    <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="function-prototype-apply"><a href="#function-prototype-apply" class="header-anchor">#</a> Function.prototype.apply()</h2> <p><code>apply()</code>调用一个指定<code>this</code>值的函数，接收作为一个数组或者类数组对象提供的参数</p> <p>语法:<code>func.apply(thisArg, [argsArray])</code></p> <h3 id="apply-将数组添加到另一个数组"><a href="#apply-将数组添加到另一个数组" class="header-anchor">#</a> apply 将数组添加到另一个数组</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;a&quot;, &quot;b&quot;, 0, 1, 2]</span>

</code></pre></div><h3 id="apply-找出最大值和最小值"><a href="#apply-找出最大值和最小值" class="header-anchor">#</a> apply 找出最大值和最小值</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span>
<span class="token keyword">var</span> min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>如果参数组非常大，将参数数组切块后，循环传入目标方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">minOfArray</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> min <span class="token operator">=</span> <span class="token number">Infinity</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">QUANTUM</span> <span class="token operator">=</span> <span class="token number">32768</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token constant">QUANTUM</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> submin <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token constant">QUANTUM</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>submin<span class="token punctuation">,</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> min<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> min <span class="token operator">=</span> <span class="token function">minOfArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span> <span class="token comment">// 2</span>

</code></pre></div><h3 id="apply原理"><a href="#apply原理" class="header-anchor">#</a> apply原理</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myApply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 第一个参数为 this 指向值，如无则指向 window</span>
  context <span class="token operator">=</span> context <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">:</span> window
  <span class="token comment">// 将本身的函数保存下来，在后面需要执行，这一步 this 的指向已经指向了 context </span>
    context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">// 将后面传入的参数转为数组，取出第二个参数</span>
    <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment">// 如果第二个参数不是对象则报错</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 执行函数本身，并将参数传入</span>
    <span class="token keyword">let</span> r <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    <span class="token comment">// 销毁函数，避免作用域污染</span>
    <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
    <span class="token keyword">return</span> r
<span class="token punctuation">}</span>

</code></pre></div><h2 id="function-prototype-bind"><a href="#function-prototype-bind" class="header-anchor">#</a> Function.prototype.bind()</h2> <p><code>bind()</code>方法创建一个新函数，在调用时设置this关键字为提供的值。</p> <p>并在调用新函数时，将给定参数列表作为原函数的参数序列的前若干项。</p> <p>语法:<code>function.bind(thisArg, [arg1[, arg2[, ...]]])</code></p> <h3 id="创建绑定函数"><a href="#创建绑定函数" class="header-anchor">#</a> 创建绑定函数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>    <span class="token comment">// 在浏览器中，this指向全局的 &quot;window&quot; 对象</span>
<span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token number">81</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getX</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 81</span>
<span class="token keyword">var</span> retrieveX <span class="token operator">=</span> module<span class="token punctuation">.</span>getX<span class="token punctuation">;</span>
<span class="token function">retrieveX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回9 - 因为函数是在全局作用域中调用的</span>

<span class="token keyword">var</span> boundGetX <span class="token operator">=</span> <span class="token function">retrieveX</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建一个新函数，把 'this' 绑定到 module 对象</span>
<span class="token function">boundGetX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 81</span>

</code></pre></div><h3 id="偏函数"><a href="#偏函数" class="header-anchor">#</a> 偏函数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">addArguments</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> arg1 <span class="token operator">+</span> arg2
<span class="token punctuation">}</span>

<span class="token keyword">var</span> list1 <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 2, 3]</span>

<span class="token keyword">var</span> result1 <span class="token operator">=</span> <span class="token function">addArguments</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

<span class="token comment">// 创建一个函数，它拥有预设参数列表。</span>
<span class="token keyword">var</span> leadingThirtysevenList <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个函数，它拥有预设的第一个参数</span>
<span class="token keyword">var</span> addThirtySeven <span class="token operator">=</span> <span class="token function">addArguments</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">var</span> list2 <span class="token operator">=</span> <span class="token function">leadingThirtysevenList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// [37]</span>

<span class="token keyword">var</span> list3 <span class="token operator">=</span> <span class="token function">leadingThirtysevenList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// [37, 1, 2, 3]</span>

<span class="token keyword">var</span> result2 <span class="token operator">=</span> <span class="token function">addThirtySeven</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 37 + 5 = 42 </span>

<span class="token keyword">var</span> result3 <span class="token operator">=</span> <span class="token function">addThirtySeven</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 37 + 5 = 42 ，第二个参数被忽略</span>

</code></pre></div><p>当<code>fn1.myCall(fn2)</code>时，绑定当前<code>this</code>需要<code>context.fn=this</code>等价于<code>context.fn=fn1</code>等价于<code>fn2.fn()</code>此时<code>fn2</code>并执行<code>fn1</code>。</p> <p>当<code>fn1.myCall.myCall(fn2)</code>是此时都是执行<code>myCall</code>函数，<code>this</code>为<code>window</code>，并执行<code>fn2</code>函数。</p> <h2 id="bind原理"><a href="#bind原理" class="header-anchor">#</a> bind原理</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">bind</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">let</span> bindArgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 获取bind方法传入的参数</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> fnArgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span> <span class="token comment">// 获取函数执行传入的参数</span>
        <span class="token keyword">return</span> <span class="token function">_this</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> bindArgs<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>fnArgs<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="new的原理"><a href="#new的原理" class="header-anchor">#</a> new的原理</h2> <p>想了解new的原理先要了解js的原型机制,先来看张图。</p> <p><img src="/knowledge/1605082229225.jpg" alt=""></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'say'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">mockNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> Constructor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取出构造函数</span>
    
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>   <span class="token comment">// new 执行会创建一个新对象</span>
    
    obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token class-name">Constructor</span><span class="token punctuation">.</span>prototype 
    
    <span class="token function">Constructor</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
    <span class="token keyword">return</span> obj
<span class="token punctuation">}</span>
<span class="token keyword">let</span> animal <span class="token operator">=</span> <span class="token function">mockNew</span><span class="token punctuation">(</span>Animal<span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">)</span>
    
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>animal<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token comment">// dog</span>
animal<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// say</span>

</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">8/25/2021, 3:56:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/knowledge/HTTPS和HTTP2.0.html" class="prev">
        HTTPS和HTTP2.0
      </a></span> <span class="next"><a href="/note/knowledge/JavaScript工作原理.html">
        JavaScript工作原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.e348a179.js" defer></script><script src="/assets/js/2.8fa949b0.js" defer></script><script src="/assets/js/40.bd24e6ed.js" defer></script>
  </body>
</html>
